<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="kr.co.doublecome.repository.mapper.AuctionDetailMapper">
	<!-- 옥션 해당페이지 retrieve -->
	<select id="auctiondetail" resultType="Auction" parameterType="int">
		select distinct a.*,
		count(b.auction_no) over(partition by b.auction_no) as bid_cnt,
		max(b.bid_price) over(partition by b.auction_no) as max_price
		from auction a
		left join bid b
		on a.auction_no = b.auction_no
		where a.auction_no = #{auctionNo}
	</select>
	
	<select id="retrieveinquiry" resultType="Auction" parameterType="int">
			select i.*, u.*
			from inquiry i
			inner join user u
			on i.user_email = u.user_email
			where auction_no = #{auctionNo}
			order by IF(ISNULL(inquiry_parent), inquiry_no, inquiry_parent) desc;
	</select>
</mapper>