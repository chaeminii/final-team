<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="kr.co.doublecome.repository.mapper.AuctionDetailMapper">
	<!-- 옥션 해당페이지 retrieve -->
	<select id="auctiondetail" resultType="Auction" parameterType="int">
		select distinct a.*,
        f.*,
		count(b.auction_no) over(partition by b.auction_no) as bid_cnt,
		max(b.bid_price) over(partition by b.auction_no) as max_price
		from auction a
		left join bid b
		on a.auction_no = b.auction_no
        inner join file f
        on a.file_group_code = f.file_group_code
		where a.auction_no = #{auctionNo}
	</select>
	
	<select id="retrieveinquiry" resultType="Auction" parameterType="int">
			select i.*, u.*
			from inquiry i
			inner join user u
			on i.user_email = u.user_email
			where auction_no = #{auctionNo}
			order by IF(ISNULL(inquiry_parent), inquiry_no, inquiry_parent) desc;
	</select>
	
	<insert id="insertInquiry" parameterType="Inquiry">
		insert into inquiry (inquiry_content, inquiry_parent, auction_no, user_email)
		values (#{inquiryContent}, 
		<if test="inquiryParent != 0">
		#{inquiryParent}
		</if>
		<if test="inquiryParent == 0">
		null
		</if>
		, #{auctionNo}, #{userEmail})
	</insert>
	
	<insert id="addAuction" parameterType="Auction">
		insert into Auction (auction_title, auction_title, auction_content, auction_limit_date, auction_buy_now, auction_min_price, user_email, file_group_code, category_code)
		values ()
	</insert>
</mapper>